var app=angular.module("mrbf",["ionic"]);app.config(function(b,a){b.state("start",{url:"/start",templateUrl:"tpl/01_start.html",controller:"mainCtrl"}).state("main",{url:"/main/:id",templateUrl:"tpl/02_main.html",controller:"classListCtrl"}).state("detail",{url:"/detail/:id",templateUrl:"tpl/03_detail.html",controller:"detailCtrl"}).state("order",{url:"/order/:id",templateUrl:"tpl/04_order.html",controller:"orderCtrl"}).state("orderdata",{url:"/order/:data",templateUrl:"tpl/04_order.html",controller:"orderCtrl"}).state("usercenter",{url:"/usercenter",templateUrl:"tpl/05_usercenter.html",controller:"userCenterCtrl"}).state("orderlist",{url:"/orderlist",templateUrl:"tpl/06_orderlist.html",controller:"orderListCtrl"}).state("cart",{url:"/cart",templateUrl:"tpl/07_cart.html",controller:"cartCtrl"});a.otherwise("start")});app.run(function(a){a.defaults.headers.post={"Content-type":"application/x-www-form-urlencoded"}});app.controller("commonCtrl",["$scope","$rootScope","$location","$state",function(d,b,c,a){b.userId=1;b.$on("$locationChangeSuccess",function(f){d.routeUrl=c.path().split("/")[1]});d.jump=function(f,e){if(e){a.go(f,e)}else{a.go(f)}}}]);app.controller("mainCtrl",["$scope","$http",function(a,b){a.hasMore=true;a.inputText={kw:""};a.$watch("inputText.kw",function(){if(a.inputText.kw){b.get("data/bf_getbykw.php?kw="+a.inputText.kw).success(function(c){if(c){a.dishList=c}})}});b.get("data/bf_getbyclass.php").success(function(c){a.dishList=c})}]);app.controller("classListCtrl",["$scope","$http","$stateParams",function(a,c,b){c.get("data/bf_getbydid.php?did="+b.id).success(function(d){a.dish=d});a.addToCart=function(e){console.log(e);var d=e.id;c.get("data/bf_addTocart.php?pid="+d).success(function(f){console.log(f)})}}]);app.controller("detailCtrl",["$scope","$rootScope","$http","$stateParams","$ionicModal",function(c,a,e,d,b){console.log(222);c.order_dish_count=1;e.get("data/bf_getbyid.php?id="+d.id).success(function(f){c.dishDetail=f[0];c.order_dish_data=c.dishDetail.pid+"&"+c.order_dish_count});b.fromTemplateUrl("order_card_modal.html",{scope:c,animation:"slide-in-up"}).then(function(f){a.modalOrder=f});a.openModal=function(){a.modalOrder.show()};a.closeModal=function(){console.log(1);a.modalOrder.hide()};a.$on("$destroy",function(){a.modalOrder.remove()});c.order_minus=function(){if(c.order_dish_count!==1){c.order_dish_count--}c.order_dish_data=c.dishDetail.pid+"&"+c.order_dish_count};c.order_plus=function(){if(c.order_dish_count!=c.dishDetail.ocount){c.order_dish_count++}c.order_dish_data=c.dishDetail.pid+"&"+c.order_dish_count};c.addToCart=function(h){var f=h.id;var g=c.order_dish_count;e.get("data/bf_addTocart.php?pid="+f+"&count="+g).success(function(i){console.log(i)})}}]);app.controller("cartCtrl",["$scope","$rootScope","$http",function(b,a,c){c.get("data/bf_getbycart.php?uid="+a.userId).success(function(d){c.get("data/bf_cartDetailCheckedUpdata.php?uid="+a.userId+"&onchecked="+0);console.log(d);b.cartList=d;a.dish_choose()});a.$on("$locationChangeSuccess",function(d){c.get("data/bf_cartDetailCheckedUpdata.php?uid="+a.userId+"&onchecked="+0)});a.watch={allChecked:false};a.dish_choose=function(d){c.get("data/bf_cartDetailCheckedUpdata.php?uid="+a.userId+"&onchecked="+d);b.cartList.forEach(function(e){e.onchecked=a.watch.allChecked})};b.dish_choose_one=function(f,e){c.get("data/bf_cartDetailCheckedUpdata.php?did="+f+"&onchecked="+e);console.log(b.cartList);for(var d=0;d<b.cartList.length;d++){if(!b.cartList[d].onchecked){a.watch.allChecked=false;return}a.watch.allChecked=true}};b.onEdit=false;b.edit_txt="编辑";b.cart_edit=function(){if(!b.onEdit){b.onEdit=true;b.edit_txt="完成"}else{b.onEdit=false;b.edit_txt="编辑"}};b.count_plus=function(e){for(var d=0;d<b.cartList.length;d++){if(b.cartList[d].did==e){b.cartList[d].scount++;c.get("data/bf_cartDetailCountupdata.php?pid="+e+"&count="+b.cartList[d].scount).success(function(f){});return}}};b.count_minus=function(e){for(var d=0;d<b.cartList.length;d++){if((b.cartList[d].did==e)&&(b.cartList[d].scount>0)){b.cartList[d].scount--;c.get("data/bf_cartDetailCountupdata.php?pid="+e+"&count="+b.cartList[d].scount).success(function(f){console.log(f)});return}}};b.count_change=function(e){for(var d=0;d<b.cartList.length;d++){console.log(b.cartList[d].did);if(e>0){console.log(b.cartList[d].scount);c.get("data/bf_cartDetailCountupdata.php?pid="+b.cartList[d].did+"&count="+e).success(function(f){console.log(f)});return}}};b.cart_del=function(d){console.log("要删除的购物车数据是"+d);c.get("data/bf_deleteCart.php?did="+d).success(function(e){console.log(e);b.cartList=e})}}]);app.controller("orderCtrl",["$scope","$rootScope","$http","$stateParams","$ionicModal",function(c,a,e,d,b){a.totalPrice=0;if(d.data){c.order_dish_id=d.data.split("&")[0];c.order_dish_count=d.data.split("&")[1];e.get("data/bf_getbyid.php?id="+c.order_dish_id).success(function(f){c.order_dish=f;c.order_dish[0].scount=c.order_dish_count;c.getTotalPrice()})}else{e.get("data/bf_order_getbycart.php?uid="+a.userId).success(function(f){console.log(f);c.order_dish=f;c.getTotalPrice()})}c.getTotalPrice=function(){c.order_dish.map(function(f){a.totalPrice+=f.scount*parseInt(f.price)})};b.fromTemplateUrl("add_addr_modal.html",{scope:c,animation:"slide-in-up"}).then(function(f){a.modalAddr=f});a.openModal=function(){a.modalAddr.show()};a.closeModal=function(){a.modalAddr.hide()};a.$on("$destroy",function(){a.modalAddr.remove()});c.user_uname="";c.user_phone="";c.user_addr="";a.submit_order=function(){var f={uname:c.user_uname,phone:c.user_phone,addr:c.user_addr,totalPrice:a.totalPrice,uid:a.uid};var g;e.post("data/bf_orderAdd.php","").success(function(){console.log("post succ!");c.jump("orderlist")})}}]);app.controller("orderListCtrl",["$scope","$http",function(a,b){b.get("data/bf_getbyOrder.php").success(function(c){console.log(c);a.orderList=c})}]);app.controller("userCenterCtrl",["$scope","$http",function(a,b){b.get("data/bf_getOrderStatus.php").success(function(c){console.log(c);a.orderStatus=c});a.selectStatus=function(c){b.get("data/bf_getOrderStatusDetail.php?status="+c).success(function(d){console.log(d);a.orderStatusDetail=d})}}]);