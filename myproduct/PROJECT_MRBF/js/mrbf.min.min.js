var app=angular.module("mrbf",["ionic"]);app.config(function(c,d){c.state("start",{url:"/start",templateUrl:"tpl/01_start.html",controller:"mainCtrl"}).state("main",{url:"/main/:id",templateUrl:"tpl/02_main.html",controller:"classListCtrl"}).state("detail",{url:"/detail/:id",templateUrl:"tpl/03_detail.html",controller:"detailCtrl"}).state("order",{url:"/order/:data",templateUrl:"tpl/04_order.html",controller:"orderCtrl"}).state("usercenter",{url:"/usercenter",templateUrl:"tpl/05_usercenter.html"}).state("orderlist",{url:"/orderlist",templateUrl:"tpl/06_orderlist.html"}).state("cart",{url:"/cart",templateUrl:"tpl/07_cart.html"});d.otherwise("start")});app.controller("commonCtrl",["$scope","$rootScope","$location","$state",function(g,e,h,f){e.$on("$locationChangeSuccess",function(a){g.routeUrl=h.path().split("/")[1]});g.jump=function(a,b){if(b){f.go(a,b)}else{f.go(a)}}}]);app.controller("mainCtrl",["$scope","$http",function(d,c){d.hasMore=true;d.inputText={kw:""};d.$watch("inputText.kw",function(){if(d.inputText.kw){c.get("data/bf_getbykw.php?kw="+d.inputText.kw).success(function(a){if(a){d.dishList=a}})}});c.get("data/bf_getbyclass.php").success(function(a){d.dishList=a})}]);app.controller("classListCtrl",["$scope","$http","$stateParams",function(e,f,d){f.get("data/bf_getbydid.php?did="+d.id).success(function(a){e.dish=a})}]);app.controller("detailCtrl",["$scope","$rootScope","$http","$stateParams","$ionicModal",function(j,g,h,i,f){console.log(222);j.order_dish_count=1;j.order_dish_data=j.dishPid+"&"+j.order_dish_count;h.get("data/bf_getbyid.php?id="+i.id).success(function(a){j.dishDetail=a[0];j.order_dish_data=j.dishDetail.pid+"&"+j.order_dish_count});f.fromTemplateUrl("order_card_modal.html",{scope:j,animation:"slide-in-up"}).then(function(a){g.modalOrder=a});g.openModal=function(){g.modalOrder.show()};g.closeModal=function(){console.log(1);g.modalOrder.hide()};g.$on("$destroy",function(){g.modalOrder.remove()});j.order_minus=function(){if(j.order_dish_count!==1){j.order_dish_count--}j.order_dish_data=j.dishDetail.pid+"&"+j.order_dish_count};j.order_plus=function(){if(j.order_dish_count!=j.dishDetail.ocount){j.order_dish_count++}j.order_dish_data=j.dishDetail.pid+"&"+j.order_dish_count}}]);app.controller("orderCtrl",["$scope","$rootScope","$http","$stateParams","$ionicModal",function(j,g,h,i,f){g.totalPrice=0;j.order_dish_id=i.data.split("&")[0];j.order_dish_count=i.data.split("&")[1];h.get("data/bf_getbyid.php?id="+j.order_dish_id).success(function(a){j.order_dish=a;j.order_dish[0].count=j.order_dish_count;j.getTotalPrice()});j.getTotalPrice=function(){j.order_dish.map(function(a){g.totalPrice+=a.count*parseInt(a.price)})};f.fromTemplateUrl("add_addr_modal.html",{scope:j,animation:"slide-in-up"}).then(function(a){g.modalAddr=a});g.openModal=function(){g.modalAddr.show()};g.closeModal=function(){g.modalAddr.hide()};g.$on("$destroy",function(){g.modalAddr.remove()})}]);